---
title: "Jump seq data analysis"
author: "Shengtong Han"
date: YYYY-MM-DD
output: html_document
---

<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->
```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("chunks.R")
```

<!-- Update knitr chunk options -->
```{r knitr-opts-chunk, include=FALSE}
```

<!-- Insert the date the file was last updated -->
```{r last-updated, echo=FALSE, results='asis'}
```

<!-- Insert the code version (Git commit SHA1) if Git repository exists and R
 package git2r is installed -->
```{r code-version, echo=FALSE, results='asis'}
```

<!-- Add your analysis here -->
## eleven 48 ng 5hmC replicates
There are 11 5hmC replicates listed below. Each one has two strands, plus+minus. 


* CHe-Lu-1_S12_L005_R1_001.umi_encoded_adaptor_removed_no_mismatch.sorted.d
edup.bam
* He-Lu-6_48ng-S3_L001_R1_001.umi_encoded_adaptor_removed_no_mismatch.sorte
d.dedup.bam
* He-lu-6_S6_L006_R1_001.umi_encoded_adaptor_removed_no_mismatch.sorted.ded
up.bam
* 20160601_5hmC_Jump_Seq_48ng.umi_encoded_adaptor_removed_no_mismatch.sorte
d.dedup.bam
* He-Lu-lu-1-48ng_S1_L006_R1_001.umi_encoded_adaptor_removed_no_mismatch.s
orted.dedup.bam
* 20161115_5hmC_Jump_Seq_2hmC_spike_in.mm9.umi_encoded_adaptor_removed_no_mismatch.sorted.dedup.bam
* 20161115_5hmC_Jump_Seq_negative_control_spike_in.mm9.umi_encoded_adaptor_removed_no_mismatch.sorted.dedup.bam
* 20161115_5hmC_Jump_Seq_positive_control_spike_in.mm9.umi_encoded_adaptor_removed_no_mismatch.sorted.dedup.bam
* Jump-2hmC-sites.mm9.umi_encoded_adaptor_removed_no_mismatch.sorted.dedup.bam
* Jump-NC-2.mm9.umi_encoded_adaptor_removed_no_mismatch.sorted.dedup.bam
* Jump-positive.mm9.umi_encoded_adaptor_removed_no_mismatch.sorted.dedup.bam

## Combining from eleven 48 ng 5hmC replicates
Once the base level coverage of each individual replicates is obtained, directly combine some of them to form a synthesized large replicate and the rest form to another such that their coverage, i.e. number of reads are as balanced as possible. In this way, power is expected to be increasing. 

* combined rep 1: 20160601 5hmC Jump Seq 48ng.He-Lu-lu-1 
48ng S1 L006 R1 001.20161115 5hmC Jump Seq 2hmC spike in.20161115 5hmC Jump Seq negative control spike in.20161115 5hmC Jump Seq positive control
* combined rep 2:CHe..Lu..1 S12 L005 R1 001:He..Lu..6 48ng ..S3 L001 R1 001:He..lu..6 S6 L006 R1 001:Jump..2hmC ..sites:Jump..NC ..2:Jump .. positive.

Two large combined replicates | \#reads
------------------------------|-----------
rep1.minus | 28179030 
rep1.plus | 28118310
rep2.minus | 22004763
rep2.plus | 21938791

### comparison with Dali Han's data
Originally called 20 bp windows are extended by 2kbp, 1kbp upstream and 1kbp downstream. Overlapping between extended peak windows (at four p value cutoffs $10^{-3}, 10^{-7}, 10^{-15}, 10^{-20}$) and Dali Han's data (window size differs among each other) are summzried below. 

Combined replicate | \#overlap.win | \#.win | ratio
-------------------|---------------|--------|------
rep1.minus.21.bp.enriched.window.p10-3.bed.extend2kbp.bed | 345920 | 1318454 | 0.2623679
rep1.minus.21.bp.enriched.window.p10-7.bed.extend2kbp.bed | 74515 | 236507 | 0.3150647
rep1..minus.21.bp.enriched.window.p10-15.bed.extend2kbp.bed | 9191 | 27656 | 0.3323329
rep1.minus.21.bp.enriched.window.p10-20.bed.extend2kbp.bed | 3686 | 11162 | 0.3302276
rep1.plus.21.bp.enriched.window.p10-3.bed.extend2kbp.bed | 344905 | 1317670 | 0.2617537
rep1.plus.21.bp.enriched.window.p10-7.bed.extend2kbp.bed | 74504 | 236568 | 0.3149369
rep1.plus.21.bp.enriched.window.p10-15.bed.extend2kbp.bed | 9167 | 27662 | 0.3313932
rep1.plus.21.bp.enriched.window.p10-20.bed.extend2kbp.bed | 3554 | 10997 | 0.3231790
rep2:minus.21.bp.enriched.window.p10-3.bed.extend2kbp.bed | 349863 | 1245093 | 0.2809935
rep2:minus.21.bp.enriched.window.p10-7.bed.extend2kbp.bed | 70615 | 199358 | 0.3542120
rep2:minus.21.bp.enriched.window.p10-15.bed.extend2kbp.bed | 8216 | 21511 | 0.3819441
rep2:minus.21.bp.enriched.window.p10-20.bed.extend2kbp.bed | 2851 | 7710 | 0.3697795
rep2:plus.21.bp.enriched.window.p10-3.bed.extend2kbp.bed | 348193 | 1243355 | 0.2800431
rep2:plus.21.bp.enriched.window.p10-7.bed.extend2kbp.bed | 71014 | 200017 | 0.3550398
rep2:plus.21.bp.enriched.window.p10-15.bed.extend2kbp.bed | 8769 | 22941 | 0.3822414
rep2:plus.21.bp.enriched.window.p10-20.bed.extend2kbp.bed | 2792 | 7557 | 0.3694588


### Comparison between replicates 
Overlapping among peak windows extended by 2kbp for 2 large combined replicates at different p value cutoffs. 


minus | $10^{-1}$| $10^{-3}$ | $10^{-5}$ |$10^{-7}$ | $10^{-15}$ | $10^{-20}$
------|----------|-|-----------|------------|-------------|--
rep1 | 0.9905  |0.9388 | 0.8425 |0.7334 | 0.4543 | 0.4056
rep2 |0.9886 | 0.9523 |  0.8961 |0.8091 | 0.5576 | 0.5612
plus |$10^{-1}$| $10^{-3}$ | $10^{-5}$|$10^{-7}$ | $10^{-15}$ | $10^{-20}$
rep1 | 0.9906 | 0.9389 | 0.8426 |0.7337 | 0.4650 | 0.3952
rep2 |0.9887 | 0.9524 | 0.8967 |0.8095 | 0.5397 | 0.5419

Surprisingly, the overlapping rate deceases as the p value cutofff becomes more stringent. 


This is the overlapping for originally called 20 bp windows at different FDR levels. 


minus | 0.5| 0.1 | 0.01|0.001 | 0.0001 |$10^{-7}$ |$10^{-10}$
------|----------|-|-----------|------------|----|-----|---
rep1 |0.3955| 0.4118 | 0.3840 | 0.3611| 0.3563| 0.3148 |0.3118
rep2 |0.4985 | 0.3915  |  0.4111 |0.4109 | 0.4023| 0.4196| 0.4231
plus |0.5| 0.1 | 0.01|0.001 | 0.0001 | $10^{-7}$ |$10^{-10}$
rep1 | 0.3954 | 0.4126 | 0.3841 |0.3627 | 0.3572 | 0.3991|0.3115
rep2 |0.4985 | 0.3907 | 0.4116 |0.4128 | 0.4030 | 0.4205| 0.4205

## Session information

<!-- Insert the session information into the document -->
```{r session-info}
```
